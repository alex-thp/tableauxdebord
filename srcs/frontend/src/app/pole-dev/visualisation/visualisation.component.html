<div *ngIf="ready === false" class="loading-indicator">
  <div class="spinner"></div>
  Chargement des donnÃ©es...
</div>
<!-- Affichage si aucun rÃ©sultat -->
<div *ngIf="notFound === true">
  RÃ©sultat non trouvÃ©. Veuillez vÃ©rifier les paramÃ¨tres de votre requÃªte.
  Si le problÃ¨me persiste, veuillez contacter l'administrateur.
</div>

<!-- Affichage des rÃ©sultats -->
<div *ngIf="dataToDisplay.length > 0">
  <button (click)="resetColumnVisibility()" class="reset-columns-button">
    ğŸ‘ï¸ RÃ©afficher toutes les colonnes
  </button>

  <table>
    <thead>
      <tr>
        <th *ngFor="let col of columns" style="position: relative;" [hidden]="!visibleColumns[col]">
          <div
            (click)="toggleFilterDropdown(col)"
            class="header-label"
            tabindex="0"
            role="button"
            aria-haspopup="listbox"
            [attr.aria-expanded]="filterDropdownOpenFor === col"
          >
            {{ col }}
          </div>

<!-- Dropdown -->
<div
  *ngIf="filterDropdownOpenFor === col"
  class="filter-dropdown"
  role="listbox"
  tabindex="0"
  (focusout)="onFilterDropdownFocusOut($event)"
>
  <div *ngIf="isDateColumn(col)">
    UltÃ©rieur Ã  : <input
      type="date"
      (change)="onDateFilterChange($event, col, 'after')"
      placeholder="AprÃ¨s"
    />
    AntÃ©rieur Ã  : <input
      type="date"
      (change)="onDateFilterChange($event, col, 'before')"
      placeholder="Avant"
    />
    <button (click)="clearDateFilter(col); toggleFilterDropdown(null)">âŒ RÃ©initialiser dates</button>
  </div>
  <!-- Filtre pour les nombres -->
<div *ngIf="isNumericColumn(col)">
  <label>Plus grand que :</label>
  <input
    type="number"
    [value]="numericFilters[col] ? numericFilters[col].greaterThan : ''"
    (input)="onNumericFilterChange($event, col, 'greaterThan')"
  />

  <label>Plus petit que :</label>
  <input
    type="number"
    [value]="numericFilters[col] ? numericFilters[col].lessThan : ''"
    (input)="onNumericFilterChange($event, col, 'lessThan')"
  />

  <button (click)="clearNumericFilter(col)">âœ•</button>
</div>
<!-- Filtres texte dynamiques -->
<div *ngIf="!isNumericColumn(col) && !isDateColumn(col)">
  <label>Contient :</label>

  <div
    *ngFor="let item of textFilters[col] || []; let i = index; trackBy: trackByTextFilter"
    class="flex items-center gap-2 mb-1"
  >
    <!-- Affiche "OU" seulement Ã  partir du deuxiÃ¨me champ -->
    <span *ngIf="i > 0" class="text-gray-500 font-semibold">ou </span>

    <input
      type="text"
      class="border rounded px-2 py-1 flex-1"
      [value]="item.value"
      (input)="onTextFilterChange($event, col, i)"
      placeholder="Saisir un texte..."
    />
  </div>

  <button
    type="button"
    class="text-sm text-red-600 mt-1"
    (click)="clearTextFilter(col)"
    *ngIf="textFilters[col]?.length"
  >
    âœ• RÃ©initialiser
  </button>
</div>
  <div
    *ngFor="let val of getUniqueValuesForColumn(col)"
    (click)="applyFilter(col, val)"
    [ngClass]="{
      'filter-option': true,
      'active': Array.isArray(activeFilters[col]) && activeFilters[col].includes(val)
    }"
  >
    {{ formatValue(val) }}
  </div>

  <div (click)="clearFilter(col); toggleFilterDropdown(null)" class="filter-option clear-filter">
    (Aucun filtre)
  </div>

  <div (click)="toggleColumnVisibility(col)" class="filter-option hide-column">
    ğŸ‘ï¸â€ğŸ—¨ï¸ Masquer cette colonne
  </div>
</div>
        </th>
      </tr>
    </thead>

    <tbody>
      <tr *ngFor="let row of filteredData">
        <td *ngFor="let col of columns" [hidden]="!visibleColumns[col]">
          {{ formatValue(row[col]) }}
        </td>
      </tr>
    </tbody>
  </table>

  <div class="fixed-row-count">
    Total affichÃ© : {{ filteredData.length }} ligne{{ filteredData.length > 1 ? 's' : '' }}
  </div>
</div>
